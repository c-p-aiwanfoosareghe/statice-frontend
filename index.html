<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediaDownloader Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; scroll-behavior: smooth; }
        .nav-link.active { color: #2563eb; border-bottom: 2px solid #2563eb; }
        .hidden-section { display: none; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen text-slate-900">

    <nav class="sticky top-0 z-50 bg-white/80 backdrop-blur-md border-b border-slate-200">
        <div class="max-w-5xl mx-auto px-6 h-16 flex items-center justify-between">
            <div class="flex items-center gap-2 font-bold text-xl cursor-pointer" onclick="showSection('home')">
                <i data-lucide="zap" class="text-blue-600 w-6 h-6"></i>
                <span>Media<span class="text-blue-600">Pro</span></span>
            </div>
            <div class="flex gap-6 text-sm font-semibold text-slate-500">
                <button onclick="showSection('home')" class="nav-link active py-5" id="nav-home">Downloader</button>
                <button onclick="showSection('faq')" class="nav-link py-5" id="nav-faq">FAQ</button>
                <button onclick="showSection('about')" class="nav-link py-5" id="nav-about">About</button>
            </div>
        </div>
    </nav>

    <main class="max-w-3xl mx-auto px-4 py-12">

        <section id="section-home">
            <header class="text-center mb-12">
                <h1 class="text-4xl font-extrabold tracking-tight">Save your favorite <span class="text-blue-600">Media</span></h1>
                <p class="text-slate-500 mt-2">Paste a link below to begin the high-speed download.</p>
            </header>

            <div class="bg-white border border-slate-200 rounded-3xl p-4 shadow-xl mb-8">
                <div class="flex flex-col md:flex-row gap-2">
                    <input type="url" id="url-input" class="flex-1 px-6 py-4 bg-slate-100 rounded-2xl outline-none focus:ring-2 focus:ring-blue-500" placeholder="Paste Instagram/Facebook URL...">
                    <button onclick="submitDownload()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-8 rounded-2xl flex items-center justify-center gap-2 transition-all">
                        <span>Download</span>
                        <i data-lucide="arrow-right" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>

            <div id="status-card" class="hidden bg-white border border-slate-200 rounded-3xl p-8 mb-8 shadow-lg">
                <div class="flex items-center justify-between mb-4">
                    <h3 id="status-title" class="text-lg font-bold">Initializing...</h3>
                    <div class="animate-spin text-blue-600"><i data-lucide="loader-2"></i></div>
                </div>
                <div class="w-full bg-slate-100 rounded-full h-3 mb-2 overflow-hidden">
                    <div id="progress-bar" class="bg-blue-600 h-full w-0 transition-all duration-500"></div>
                </div>
                <p id="status-desc" class="text-xs text-slate-400 uppercase font-bold tracking-widest">0% Complete</p>
            </div>

            <div id="result-card" class="hidden bg-white border-2 border-blue-600 rounded-3xl overflow-hidden shadow-2xl mb-8">
                <div class="md:flex">
                    <div class="md:w-48 bg-slate-200 h-48 md:h-auto overflow-hidden">
                        <img id="video-thumbnail" src="" alt="Preview" class="w-full h-full object-cover">
                        <div id="thumbnail-placeholder" class="hidden flex items-center justify-center h-full text-slate-400">
                            <i data-lucide="video" class="w-12 h-12"></i>
                        </div>
                    </div>
                    <div class="p-6 flex-1">
                        <div class="flex justify-between items-start mb-2">
                            <span id="source-badge" class="px-3 py-1 bg-blue-100 text-blue-600 rounded-full text-xs font-bold uppercase">Source</span>
                        </div>
                        <h4 id="video-title" class="font-bold text-xl mb-1 truncate w-64">Video Title</h4>
                        <p id="video-size" class="text-slate-500 text-sm mb-6 font-medium tracking-tight">Size: ...</p>
                        <a id="download-btn" href="#" target="_blank" class="w-full inline-flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl shadow-lg shadow-blue-200">
                            <i data-lucide="download"></i> Download Video
                        </a>
                    </div>
                </div>
            </div>
        </section>

        <section id="section-faq" class="hidden-section">
            <h2 class="text-3xl font-extrabold mb-8">Frequently Asked Questions</h2>
            <div class="space-y-4">
                <div class="bg-white p-6 rounded-2xl border border-slate-200">
                    <h4 class="font-bold text-lg mb-2">Which platforms are supported?</h4>
                    <p class="text-slate-600 text-sm">Currently, we support public video URLs from Instagram (Reels, Posts) and Facebook. Private accounts cannot be accessed.</p>
                </div>
                <div class="bg-white p-6 rounded-2xl border border-slate-200">
                    <h4 class="font-bold text-lg mb-2">How long do files stay on the server?</h4>
                    <p class="text-slate-600 text-sm">Files are stored in temporary storage. Due to our free hosting policy, they are cleared periodically. Download your file immediately after it's ready.</p>
                </div>
                <div class="bg-white p-6 rounded-2xl border border-slate-200">
                    <h4 class="font-bold text-lg mb-2">Is there a file size limit?</h4>
                    <p class="text-slate-600 text-sm">We recommend downloading videos under 50MB to ensure stability on our free tier servers.</p>
                </div>
            </div>
        </section>

        <section id="section-about" class="hidden-section">
            <h2 class="text-3xl font-extrabold mb-8">About MediaPro</h2>
            <div class="prose text-slate-600 leading-relaxed">
                <p class="mb-4">MediaPro was built to provide a clean, ad-free experience for downloading social media content for educational and creative use.</p>
                <div class="bg-blue-50 border-l-4 border-blue-600 p-6 rounded-r-2xl mb-6">
                    <h4 class="text-blue-900 font-bold mb-1">Our Privacy Promise</h4>
                    <p class="text-blue-800 text-sm">We don't track your downloads or store your personal data. The URLs you paste are processed and discarded once the file is ready.</p>
                </div>
                <p>Built with <strong>FastAPI</strong>, <strong>yt-dlp</strong>, and <strong>Tailwind CSS</strong>.</p>
            </div>
        </section>

    </main>

    <script>
        // CONFIG: Update this to your Render URL!
        const API_BASE_URL = "https://gemini-social-downloader-klsf.onrender.com/api/v1"; 

        lucide.createIcons();

        // ðŸŸ¢ NAVIGATION LOGIC
        function showSection(name) {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden-section'));
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            
            document.getElementById(`section-${name}`).classList.remove('hidden-section');
            document.getElementById(`nav-${name}`).classList.add('active');
        }

        // ðŸ”µ DOWNLOAD LOGIC
        async function submitDownload() {
            const url = document.getElementById('url-input').value;
            const statusCard = document.getElementById('status-card');
            const resultCard = document.getElementById('result-card');

            if (!url) return alert("Please paste a URL first!");

            resultCard.classList.add('hidden');
            statusCard.classList.remove('hidden');
            updateStatusUI('PENDING', 0, 'Waking up server...');

            try {
                const response = await fetch(`${API_BASE_URL}/download/submit`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url: url }) 
                });
                const data = await response.json();
                if (response.ok) pollStatus(data.job_id);
                else alert(data.detail || "Submission Error");
            } catch (e) {
                alert("Connection error. Is the backend deployed?");
            }
        }

        function pollStatus(jobId) {
            const interval = setInterval(async () => {
                const response = await fetch(`${API_BASE_URL}/download/status/${jobId}`);
                const data = await response.json();
                updateStatusUI(data.status, data.progress, data.message);

                if (data.status === 'COMPLETED') {
                    clearInterval(interval);
                    showResult(data, jobId);
                } else if (data.status === 'FAILED') {
                    clearInterval(interval);
                    alert("Download failed: " + data.message);
                }
            }, 2000);
        }

        function updateStatusUI(status, progress, message) {
            document.getElementById('status-title').innerText = status;
            document.getElementById('progress-bar').style.width = `${progress}%`;
            document.getElementById('status-desc').innerText = `${progress}% â€¢ ${message}`;
        }

        function showResult(data, jobId) {
            document.getElementById('status-card').classList.add('hidden');
            const resultCard = document.getElementById('result-card');
            const meta = data.metadata || {};

            // ðŸ“¸ THUMBNAIL LOGIC
            const thumbImg = document.getElementById('video-thumbnail');
            const placeholder = document.getElementById('thumbnail-placeholder');
            
            if (meta.thumbnail) {
                thumbImg.src = meta.thumbnail;
                thumbImg.classList.remove('hidden');
                placeholder.classList.add('hidden');
            } else {
                thumbImg.classList.add('hidden');
                placeholder.classList.remove('hidden');
            }

            document.getElementById('video-title').innerText = meta.filename || "Your Video";
            document.getElementById('source-badge').innerText = meta.source || "Social Media";
            
            const sizeMB = meta.size_bytes ? (meta.size_bytes / (1024 * 1024)).toFixed(2) : '??';
            document.getElementById('video-size').innerText = `Estimated Size: ${sizeMB} MB`;

            const btn = document.getElementById('download-btn');
            btn.href = data.download_path.startsWith('http') ? data.download_path : `${API_BASE_URL}/download/file/${jobId}`;
            
            resultCard.classList.remove('hidden');
        }
    </script>
</body>
</html>
